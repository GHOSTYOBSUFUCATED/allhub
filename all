-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
-- â•‘              SloDyZz HUB  â€”  FUSION EDITION            â•‘
-- â•‘  Insta Grab Â· Anti Trap Â· Speed/Jump Â· Anti Knockback  â•‘
-- â•‘  Anti Scam Â· Auto Leave Defender Â· Admin Kick Â· ESP    â•‘
-- â•‘  Auto Load Config â€” version finale corrigÃ©e v2.1       â•‘
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Players              = game:GetService("Players")
local ReplicatedStorage    = game:GetService("ReplicatedStorage")
local UserInputService     = game:GetService("UserInputService")
local TweenService         = game:GetService("TweenService")
local RunService           = game:GetService("RunService")
local TeleportService      = game:GetService("TeleportService")
local HttpService          = game:GetService("HttpService")

local localPlayer = Players.LocalPlayer
if not localPlayer.Character then localPlayer.CharacterAdded:Wait() end
task.wait(0.5)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  QUITTER LE JEU
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function leaveGame()
    pcall(function() localPlayer:Kick() end)
    task.wait(0.05)
    pcall(function() TeleportService:Teleport(game.PlaceId) end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  REMOTE ADMIN
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local NetRemote, remoteReady = nil, false
task.spawn(function()
    local function findRemote()
        local Packages = ReplicatedStorage:WaitForChild("Packages", 5)
        if Packages then
            local Net = Packages:WaitForChild("Net", 5)
            if Net then
                local r = Net:FindFirstChild("RE/352aad5B-c786-4998-886b-3e4fa390721e")
                if r and r:IsA("RemoteEvent") then return r end
                for _, obj in pairs(Net:GetChildren()) do
                    if obj:IsA("RemoteEvent") and obj.Name:lower() == "re/352aad5b-c786-4998-886b-3e4fa390721e" then
                        return obj
                    end
                end
            end
        end
        for _, obj in pairs(game:GetDescendants()) do
            if obj:IsA("RemoteEvent") and obj.Name:lower():find("352aad5") then return obj end
        end
        return nil
    end
    for i = 1, 100 do
        NetRemote = findRemote()
        if NetRemote then remoteReady = true; break end
        task.wait(0.1)
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  PLOT DETECTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local myDisplayName = localPlayer.DisplayName
local myPlot, myPlotPodiums = nil, {}

local function findMyPlot()
    local pf = workspace:FindFirstChild("Plots")
    if not pf then return nil end
    for _, plot in pairs(pf:GetChildren()) do
        local ps = plot:FindFirstChild("PlotSign")
        if not ps then continue end
        local yourBase = ps:FindFirstChild("YourBase")
        if yourBase and yourBase:IsA("BillboardGui") and yourBase.Enabled then return plot end
        local sg = ps:FindFirstChild("SurfaceGui")
        if not sg then continue end
        local fr = sg:FindFirstChild("Frame")
        if not fr then continue end
        local tl = fr:FindFirstChild("TextLabel")
        if tl and tl.Text:find(myDisplayName) and tl.Text:find("'s Base") then return plot end
    end
end

local function getAnimalPodiums(plot)
    local pos = {}
    local folder = plot:FindFirstChild("AnimalPodiums")
    if not folder then return pos end
    for i = 1, 10 do
        local p = folder:FindFirstChild(tostring(i))
        if p and p:IsA("Model") then pos[i] = p:GetPivot().Position end
    end
    return pos
end

task.spawn(function()
    task.wait(2)
    myPlot = findMyPlot()
    if myPlot then myPlotPodiums = getAnimalPodiums(myPlot) end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  Ã‰TATS GLOBAUX
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local State = {
    StealBar        = false,
    AntiScam        = false,
    AutoDefense     = false,
    AutoLeave       = false,
    AntiKnockback   = false,
    InstaGrab       = false,
    GrabRadius      = 20,
    AntiTrap        = false,
    SpeedBoost      = false,
    SpeedValue      = 22.5,
    JumpValue       = 35,
    BaseESP         = false,
    SkeletonESP     = false,
    HitboxESP       = false,
}

local selectedPlayers  = {}
local selectedUserIds  = {}
local stealingDetected = false
local lastDefenseTime  = 0
local antiScamLastTime = 0
local leaveDefLastTime = 0
local defenseCooldown  = 3
local antiScamCooldown = 3
local leaveDefCooldown = 5
local rangeStuds       = 9

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  RÃ‰FÃ‰RENCES UI (dÃ©clarÃ©es tÃ´t pour closures)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local UIReferences = {
    toggles = {},
    sliders = {},
}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  FORWARD DECLARATIONS (fonctions dÃ©finies plus bas)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local syncUIWithState
local applyLoadedEffects

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  SYSTÃˆME CONFIG â€” Save / Load
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local CONFIG_FOLDER = "SloDyZzHub"
local CONFIG_FILE   = CONFIG_FOLDER .. "/config.json"

local function executorSupportsFiles()
    return type(isfolder)    == "function"
       and type(makefolder)  == "function"
       and type(isfile)      == "function"
       and type(writefile)   == "function"
       and type(readfile)    == "function"
end

local function ensureFolder()
    local ok, exists = pcall(isfolder, CONFIG_FOLDER)
    if ok and not exists then
        pcall(makefolder, CONFIG_FOLDER)
    end
end

local function saveConfig()
    if not executorSupportsFiles() then
        warn("[SloDyZz] âŒ Executor incompatible (fichiers non supportÃ©s).")
        return false
    end
    ensureFolder()

    local data = {
        StealBar      = State.StealBar,
        AntiScam      = State.AntiScam,
        AutoDefense   = State.AutoDefense,
        AutoLeave     = State.AutoLeave,
        AntiKnockback = State.AntiKnockback,
        AntiTrap      = State.AntiTrap,
        RangeStuds    = rangeStuds,
        InstaGrab     = State.InstaGrab,
        GrabRadius    = State.GrabRadius,
        SpeedBoost    = State.SpeedBoost,
        SpeedValue    = State.SpeedValue,
        JumpValue     = State.JumpValue,
        BaseESP       = State.BaseESP,
        SkeletonESP   = State.SkeletonESP,
        HitboxESP     = State.HitboxESP,
        Version       = "2.1",
        SavedAt       = os.date("%Y-%m-%d %H:%M:%S"),
    }

    local encOk, json = pcall(HttpService.JSONEncode, HttpService, data)
    if not encOk then
        warn("[SloDyZz] âŒ JSON encode: " .. tostring(json))
        return false
    end

    local writeOk = pcall(writefile, CONFIG_FILE, json)
    if writeOk then
        print("[SloDyZz] âœ… Config sauvegardÃ©e â†’ " .. CONFIG_FILE)
        return true
    else
        warn("[SloDyZz] âŒ Ã‰criture impossible.")
        return false
    end
end

local function loadConfig()
    if not executorSupportsFiles() then return nil end

    local existsOk, exists = pcall(isfile, CONFIG_FILE)
    if not existsOk or not exists then return nil end

    local readOk, raw = pcall(readfile, CONFIG_FILE)
    if not readOk or not raw or raw == "" then return nil end

    local decOk, data = pcall(HttpService.JSONDecode, HttpService, raw)
    if not decOk or type(data) ~= "table" then
        warn("[SloDyZz] âš ï¸ Config corrompue, ignorÃ©e.")
        return nil
    end
    return data
end

local function applyConfig(cfg)
    if type(cfg) ~= "table" then return false end
    local function get(k, fb)
        local v = cfg[k]
        return (v ~= nil) and v or fb
    end
    State.StealBar      = get("StealBar",      State.StealBar)
    State.AntiScam      = get("AntiScam",      State.AntiScam)
    State.AutoDefense   = get("AutoDefense",   State.AutoDefense)
    State.AutoLeave     = get("AutoLeave",     State.AutoLeave)
    State.AntiKnockback = get("AntiKnockback", State.AntiKnockback)
    State.AntiTrap      = get("AntiTrap",      State.AntiTrap)
    rangeStuds          = get("RangeStuds",    rangeStuds)
    State.InstaGrab     = get("InstaGrab",     State.InstaGrab)
    State.GrabRadius    = get("GrabRadius",    State.GrabRadius)
    State.SpeedBoost    = get("SpeedBoost",    State.SpeedBoost)
    State.SpeedValue    = get("SpeedValue",    State.SpeedValue)
    State.JumpValue     = get("JumpValue",     State.JumpValue)
    State.BaseESP       = get("BaseESP",       State.BaseESP)
    State.SkeletonESP   = get("SkeletonESP",   State.SkeletonESP)
    State.HitboxESP     = get("HitboxESP",     State.HitboxESP)
    return true
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  STEAL BAR 50%
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local knownObjects = {}
local stealBarCD   = 0
task.spawn(function()
    task.wait(4)
    local pg = localPlayer:WaitForChild("PlayerGui")
    for _, obj in ipairs(pg:GetDescendants()) do knownObjects[obj] = true end
    pg.DescendantAdded:Connect(function(obj)
        if not State.StealBar or knownObjects[obj] or not obj:IsA("Frame") then
            knownObjects[obj] = true
            return
        end
        task.spawn(function()
            task.wait(0.05)
            while obj and obj.Parent do
                local cx, cy = obj.Size.X.Scale, obj.Size.Y.Scale
                if (cx >= 0.48 and cx < 0.99) or (cy >= 0.48 and cy < 0.99) then
                    if tick() > stealBarCD then
                        stealBarCD = tick() + 8
                        leaveGame()
                        return
                    end
                end
                task.wait(0.05)
            end
        end)
        knownObjects[obj] = true
    end)
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  NOTIF STEAL
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
task.spawn(function()
    local stealRemote
    for i = 1, 20 do
        local pkg = ReplicatedStorage:FindFirstChild("Packages")
        if pkg then
            local net = pkg:FindFirstChild("Net")
            if net then
                stealRemote = net:FindFirstChild("RE/NotificationService/Notify")
                if stealRemote then break end
            end
        end
        task.wait(0.5)
    end
    if not stealRemote then return end
    stealRemote.OnClientEvent:Connect(function(msg)
        if typeof(msg) == "string" and msg:lower():find("steal") then
            stealingDetected = true
        end
    end)
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  HEARTBEAT PROTECTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local checkTimer = 0
RunService.Heartbeat:Connect(function(dt)
    checkTimer += dt
    if checkTimer < 0.08 then return end
    checkTimer = 0

    if State.AntiScam and myPlot then
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= localPlayer and plr.Character then
                local root = plr.Character:FindFirstChild("HumanoidRootPart")
                if root then
                    for _, podiumPos in pairs(myPlotPodiums) do
                        if (root.Position - podiumPos).Magnitude < rangeStuds then
                            if (tick() - antiScamLastTime) > antiScamCooldown then
                                antiScamLastTime = tick()
                                leaveGame()
                            end
                        end
                    end
                end
            end
        end
    end

    if State.AutoDefense and stealingDetected and remoteReady and #selectedPlayers > 0 then
        stealingDetected = false
        if (tick() - lastDefenseTime) > defenseCooldown then
            for _, plr in ipairs(selectedPlayers) do
                if plr and plr.Parent == Players then
                    pcall(function()
                        NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", plr, "kick")
                    end)
                end
            end
            lastDefenseTime = tick()
        end
    end

    if State.AutoLeave and stealingDetected then
        stealingDetected = false
        if (tick() - leaveDefLastTime) > leaveDefCooldown then
            leaveDefLastTime = tick()
            leaveGame()
        end
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  INSTA GRAB
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local AnimalsData
pcall(function()
    AnimalsData = require(ReplicatedStorage:WaitForChild("Datas", 5):WaitForChild("Animals", 5))
end)

local allAnimalsCache    = {}
local PromptMemCache     = {}
local InternalStealCache = {}
local IsStealing         = false
local StealProgress      = 0

local function getHRP()
    local char = localPlayer.Character
    if not char then return nil end
    return char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("UpperTorso")
end

local function isMyBase(plotName)
    local plot = workspace.Plots and workspace.Plots:FindFirstChild(plotName)
    if not plot then return false end
    local sign = plot:FindFirstChild("PlotSign")
    if sign then
        local yb = sign:FindFirstChild("YourBase")
        if yb and yb:IsA("BillboardGui") then return yb.Enabled end
    end
    return false
end

local function scanSinglePlot(plot)
    if not plot or not plot:IsA("Model") then return end
    if isMyBase(plot.Name) then return end
    local podiums = plot:FindFirstChild("AnimalPodiums")
    if not podiums then return end
    for _, podium in ipairs(podiums:GetChildren()) do
        if podium:IsA("Model") and podium:FindFirstChild("Base") then
            local animalName = "Unknown"
            local spawnFolder = podium.Base:FindFirstChild("Spawn")
            if spawnFolder then
                for _, child in ipairs(spawnFolder:GetChildren()) do
                    if child:IsA("Model") and child.Name ~= "PromptAttachment" then
                        animalName = child.Name
                        if AnimalsData then
                            local info = AnimalsData[animalName]
                            if info and info.DisplayName then animalName = info.DisplayName end
                        end
                        break
                    end
                end
            end
            table.insert(allAnimalsCache, {
                name          = animalName,
                plot          = plot.Name,
                slot          = podium.Name,
                worldPosition = podium:GetPivot().Position,
                uid           = plot.Name .. "_" .. podium.Name,
            })
        end
    end
end

local function initScanner()
    task.wait(2)
    local plots = workspace:WaitForChild("Plots", 10)
    if not plots then return end
    for _, plot in ipairs(plots:GetChildren()) do
        if plot:IsA("Model") then scanSinglePlot(plot) end
    end
    plots.ChildAdded:Connect(function(p)
        if p:IsA("Model") then task.wait(0.5); scanSinglePlot(p) end
    end)
    task.spawn(function()
        while task.wait(5) do
            allAnimalsCache = {}
            for _, p in ipairs(plots:GetChildren()) do
                if p:IsA("Model") then scanSinglePlot(p) end
            end
        end
    end)
end

local function findPromptForAnimal(data)
    if not data then return nil end
    local cached = PromptMemCache[data.uid]
    if cached and cached.Parent then return cached end
    local plot = workspace.Plots and workspace.Plots:FindFirstChild(data.plot)
    if not plot then return nil end
    local podiums = plot:FindFirstChild("AnimalPodiums")
    if not podiums then return nil end
    local podium = podiums:FindFirstChild(data.slot)
    if not podium then return nil end
    local base = podium:FindFirstChild("Base")
    if not base then return nil end
    local spawnFolder = base:FindFirstChild("Spawn")
    if not spawnFolder then return nil end
    local attach = spawnFolder:FindFirstChild("PromptAttachment")
    if not attach then return nil end
    for _, p in ipairs(attach:GetChildren()) do
        if p:IsA("ProximityPrompt") then
            PromptMemCache[data.uid] = p
            return p
        end
    end
    return nil
end

local function buildCallbacks(prompt)
    if InternalStealCache[prompt] then return end
    local data = { holdCBs = {}, triggerCBs = {}, ready = true }
    local ok1, c1 = pcall(getconnections, prompt.PromptButtonHoldBegan)
    if ok1 and type(c1) == "table" then
        for _, c in ipairs(c1) do
            if type(c.Function) == "function" then table.insert(data.holdCBs, c.Function) end
        end
    end
    local ok2, c2 = pcall(getconnections, prompt.Triggered)
    if ok2 and type(c2) == "table" then
        for _, c in ipairs(c2) do
            if type(c.Function) == "function" then table.insert(data.triggerCBs, c.Function) end
        end
    end
    if #data.holdCBs > 0 or #data.triggerCBs > 0 then
        InternalStealCache[prompt] = data
    end
end

local function executeSteal(prompt)
    local data = InternalStealCache[prompt]
    if not data or not data.ready then return false end
    data.ready  = false
    IsStealing  = true
    StealProgress = 0
    task.spawn(function()
        for _, fn in ipairs(data.holdCBs) do task.spawn(fn) end
        local s = tick()
        while tick() - s < 1.3 do
            StealProgress = (tick() - s) / 1.3
            task.wait(0.05)
        end
        StealProgress = 1
        for _, fn in ipairs(data.triggerCBs) do task.spawn(fn) end
        task.wait(0.1); data.ready = true
        task.wait(0.3); IsStealing = false; StealProgress = 0
    end)
    return true
end

local function attemptSteal(prompt)
    if not prompt or not prompt.Parent then return false end
    buildCallbacks(prompt)
    if not InternalStealCache[prompt] then return false end
    return executeSteal(prompt)
end

local function getNearestAnimal()
    local hrp = getHRP()
    if not hrp then return nil end
    local nearest, minDist = nil, math.huge
    for _, a in ipairs(allAnimalsCache) do
        if not isMyBase(a.plot) and a.worldPosition then
            local d = (hrp.Position - a.worldPosition).Magnitude
            if d < minDist then minDist = d; nearest = a end
        end
    end
    return nearest
end

RunService.Heartbeat:Connect(function()
    if not State.InstaGrab or IsStealing then return end
    local target = getNearestAnimal()
    if not target then return end
    local hrp = getHRP()
    if not hrp then return end
    if (hrp.Position - target.worldPosition).Magnitude > State.GrabRadius then return end
    local prompt = PromptMemCache[target.uid]
    if not prompt or not prompt.Parent then prompt = findPromptForAnimal(target) end
    if prompt then attemptSteal(prompt) end
end)

task.spawn(initScanner)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  ANTI TRAP
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local processedTraps = {}
local BARRIER_OFFSET = 3

local function isTrapPlaced(trapModel)
    local pp = trapModel.PrimaryPart or trapModel:FindFirstChildWhichIsA("BasePart")
    if pp and pp.Anchored then return true end
    for _, p in pairs(trapModel:GetDescendants()) do
        if p:IsA("BasePart") and p.Anchored then return true end
    end
    if trapModel.Parent == workspace then
        for _, plr in pairs(Players:GetPlayers()) do
            if plr.Character then
                local d = (trapModel:GetPivot().Position - plr.Character:GetPivot().Position).Magnitude
                if d < 10 then return false end
            end
        end
        return true
    end
    return false
end

local function createTrapBarrier(trapModel)
    if processedTraps[trapModel] then return end
    task.wait(0.5)
    if not isTrapPlaced(trapModel) then return end
    processedTraps[trapModel] = true
    local pp = trapModel.PrimaryPart or trapModel:FindFirstChildWhichIsA("BasePart")
    if not pp then return end
    local cf, size = trapModel:GetBoundingBox()

    local barrier = Instance.new("Part")
    barrier.Name         = "TrapBarrier"
    barrier.Size         = size + Vector3.new(BARRIER_OFFSET * 2, size.Y, BARRIER_OFFSET * 2)
    barrier.CFrame       = cf
    barrier.Anchored     = true
    barrier.CanCollide   = true
    barrier.Transparency = 0.8
    barrier.Material     = Enum.Material.ForceField
    barrier.Color        = Color3.fromRGB(0, 255, 0)
    barrier.CanQuery     = false
    barrier.CanTouch     = false
    barrier.Parent       = workspace

    local sel = Instance.new("SelectionBox")
    sel.Adornee           = barrier
    sel.LineThickness     = 0.1
    sel.Color3            = Color3.fromRGB(0, 255, 0)
    sel.SurfaceColor3     = Color3.fromRGB(0, 255, 0)
    sel.SurfaceTransparency = 0.8
    sel.Transparency      = 0
    sel.Parent            = barrier

    local hl = Instance.new("Highlight")
    hl.Adornee           = barrier
    hl.FillColor         = Color3.fromRGB(0, 255, 0)
    hl.OutlineColor      = Color3.fromRGB(0, 255, 0)
    hl.FillTransparency  = 0.9
    hl.OutlineTransparency = 0.3
    hl.Parent            = barrier

    for _, p in pairs(trapModel:GetDescendants()) do
        if p:IsA("BasePart") then
            p.CanCollide = false; p.CanTouch = false; p.Transparency = 1
        end
        if p:IsA("TouchTransmitter") or p:IsA("Script") or p:IsA("LocalScript") then
            p:Destroy()
        end
    end

    trapModel.AncestryChanged:Connect(function(_, parent)
        if not parent then
            processedTraps[trapModel] = nil
            if barrier and barrier.Parent then barrier:Destroy() end
        end
    end)
end

local function scanTraps(parent)
    for _, obj in pairs(parent:GetDescendants()) do
        if obj:IsA("Model") and obj.Name:lower():find("trap") then
            if isTrapPlaced(obj) then
                task.spawn(function() createTrapBarrier(obj) end)
            end
        end
    end
end

local function startAntiTrap()
    scanTraps(workspace)
    workspace.DescendantAdded:Connect(function(obj)
        if not State.AntiTrap then return end
        if obj:IsA("Model") and obj.Name:lower():find("trap") then
            task.spawn(function()
                task.wait(0.5)
                if obj.Parent and isTrapPlaced(obj) then createTrapBarrier(obj) end
            end)
        end
    end)
end

task.spawn(function() task.wait(2); startAntiTrap() end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  ANTI KNOCKBACK / RAGDOLL
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local antiKBConns = {}

local function isKnockState(hum)
    local bad = {
        [Enum.HumanoidStateType.Physics]     = true,
        [Enum.HumanoidStateType.Ragdoll]     = true,
        [Enum.HumanoidStateType.FallingDown] = true,
        [Enum.HumanoidStateType.GettingUp]   = true,
    }
    return bad[hum:GetState()]
end

local function cleanCharacter(character, cleanMovers)
    for _, d in pairs(character:GetDescendants()) do
        if d:IsA("BallSocketConstraint") or d:IsA("NoCollisionConstraint") or d:IsA("HingeConstraint") then
            d:Destroy()
        elseif d:IsA("Attachment") and (d.Name == "A" or d.Name == "B") then
            d:Destroy()
        elseif cleanMovers and (d:IsA("BodyVelocity") or d:IsA("BodyPosition") or d:IsA("BodyGyro")) then
            d:Destroy()
        end
    end
    for _, d in pairs(character:GetDescendants()) do
        if d:IsA("Motor6D") then d.Enabled = true end
    end
end

local function stopKnockAnims(animator)
    for _, t in pairs(animator:GetPlayingAnimationTracks()) do
        if t.Animation then
            local n = t.Animation.Name:lower()
            if n:find("rag") or n:find("fall") or n:find("hurt") or n:find("down") or n:find("knock") or n:find("stun") then
                t:Stop(0)
            end
        end
    end
end

local function enableControls()
    pcall(function()
        require(localPlayer:WaitForChild("PlayerScripts"):WaitForChild("PlayerModule")):GetControls():Enable()
    end)
end

local function disableAntiKnockback()
    for _, c in pairs(antiKBConns) do pcall(function() c:Disconnect() end) end
    antiKBConns = {}
end

local function enableAntiKnockback()
    disableAntiKnockback()
    local char     = localPlayer.Character or localPlayer.CharacterAdded:Wait()
    local hum      = char:WaitForChild("Humanoid")
    local hrp      = char:WaitForChild("HumanoidRootPart")
    local animator = hum:WaitForChild("Animator")
    local cam      = workspace.CurrentCamera
    local lastVel  = Vector3.zero

    local function applyDefense()
        cleanCharacter(char, true)
        stopKnockAnims(animator)
        enableControls()
    end

    table.insert(antiKBConns, hum.StateChanged:Connect(function(_, new)
        if not State.AntiKnockback then return end
        if isKnockState(hum) then
            hum:ChangeState(Enum.HumanoidStateType.Running)
            applyDefense()
            cam.CameraSubject = hum
        end
    end))

    pcall(function()
        local net = ReplicatedStorage:FindFirstChild("Packages") and ReplicatedStorage.Packages:FindFirstChild("Net")
        if net then
            local imp = net:FindFirstChild("RE/CombatService/ApplyImpulse")
            if imp then
                table.insert(antiKBConns, imp.OnClientEvent:Connect(function()
                    if State.AntiKnockback then hrp.AssemblyLinearVelocity = Vector3.zero end
                end))
            end
        end
    end)

    table.insert(antiKBConns, char.DescendantAdded:Connect(function()
        if State.AntiKnockback then applyDefense() end
    end))

    table.insert(antiKBConns, RunService.Heartbeat:Connect(function()
        if not State.AntiKnockback then return end
        applyDefense()
        local vel    = hrp.AssemblyLinearVelocity
        local change = (vel - lastVel).Magnitude
        if change > 40 and vel.Magnitude > 25 then
            hrp.AssemblyLinearVelocity = vel.Unit * math.min(vel.Magnitude, 15)
        end
        lastVel = vel
    end))

    table.insert(antiKBConns, localPlayer.CharacterAdded:Connect(function(newChar)
        char     = newChar
        hum      = newChar:WaitForChild("Humanoid")
        hrp      = newChar:WaitForChild("HumanoidRootPart")
        animator = hum:WaitForChild("Animator")
        lastVel  = Vector3.zero
        enableControls()
        cleanCharacter(newChar, true)
        stopKnockAnims(animator)
    end))

    applyDefense()
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  ESP BASES WITH TIMER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local baseEspInstances = {}
local espBaseThread    = nil

local function createBaseESP(plot, mainPart)
    if baseEspInstances[plot.Name] then
        baseEspInstances[plot.Name]:Destroy()
    end
    local billboard = Instance.new("BillboardGui")
    billboard.Name         = "BaseESP_" .. plot.Name
    billboard.Size         = UDim2.new(0, 80, 0, 35)
    billboard.StudsOffset  = Vector3.new(0, 5, 0)
    billboard.AlwaysOnTop  = true
    billboard.Adornee      = mainPart
    billboard.MaxDistance  = 1000
    billboard.Parent       = plot

    local label = Instance.new("TextLabel")
    label.Size                  = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextScaled            = true
    label.Font                  = Enum.Font.GothamBlack
    label.TextColor3            = Color3.fromRGB(255, 220, 0)
    label.TextStrokeTransparency = 0
    label.TextStrokeColor3      = Color3.new(0, 0, 0)
    label.Parent                = billboard

    baseEspInstances[plot.Name] = billboard
    return billboard
end

local function updateBaseESP()
    if not State.BaseESP then return end
    local plotsFolder = workspace:FindFirstChild("Plots")
    if not plotsFolder then return end
    for _, plot in ipairs(plotsFolder:GetChildren()) do
        local purchases = plot:FindFirstChild("Purchases")
        local plotBlock = purchases and purchases:FindFirstChild("PlotBlock")
        local mainPart  = plotBlock and plotBlock:FindFirstChild("Main")
        local billboard = baseEspInstances[plot.Name]
        local timeLabel = mainPart
            and mainPart:FindFirstChild("BillboardGui")
            and mainPart.BillboardGui:FindFirstChild("RemainingTime")
        if timeLabel and mainPart then
            billboard = billboard or createBaseESP(plot, mainPart)
            local lbl = billboard:FindFirstChildWhichIsA("TextLabel")
            if lbl then lbl.Text = timeLabel.Text end
        elseif billboard then
            billboard:Destroy()
            baseEspInstances[plot.Name] = nil
        end
    end
end

local function enableBaseESP()
    if espBaseThread then espBaseThread:Disconnect() end
    espBaseThread = RunService.RenderStepped:Connect(updateBaseESP)
end

local function disableBaseESP()
    if espBaseThread then espBaseThread:Disconnect(); espBaseThread = nil end
    for _, bb in pairs(baseEspInstances) do if bb then bb:Destroy() end end
    baseEspInstances = {}
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  ESP SKELETON
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local skeletonConnections = {}
local skeletonHighlights  = {}
local ESP_SKELETON_COLOR  = Color3.fromRGB(0, 120, 255)

local function createSkeletonESP(character)
    if not State.SkeletonESP or not character then return end
    if skeletonHighlights[character] then return end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end
    local highlights = {}
    for _, part in pairs(character:GetDescendants()) do
        if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
            local hl = Instance.new("Highlight")
            hl.Adornee             = part
            hl.FillColor           = ESP_SKELETON_COLOR
            hl.FillTransparency    = 0.5
            hl.OutlineColor        = ESP_SKELETON_COLOR
            hl.OutlineTransparency = 0
            hl.DepthMode           = Enum.HighlightDepthMode.AlwaysOnTop
            hl.Parent              = part
            table.insert(highlights, hl)
        end
    end
    skeletonHighlights[character] = highlights
    local function cleanup()
        if skeletonHighlights[character] then
            for _, hl in pairs(skeletonHighlights[character]) do if hl then hl:Destroy() end end
            skeletonHighlights[character] = nil
        end
    end
    table.insert(skeletonConnections, humanoid.Died:Connect(cleanup))
    table.insert(skeletonConnections, character.AncestryChanged:Connect(function(_, p)
        if not p then cleanup() end
    end))
end

local function enableSkeletonESP()
    for _, c in pairs(skeletonConnections) do pcall(function() c:Disconnect() end) end
    skeletonConnections = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character then
            createSkeletonESP(player.Character)
        end
    end
    table.insert(skeletonConnections, Players.PlayerAdded:Connect(function(player)
        if player == localPlayer then return end
        table.insert(skeletonConnections, player.CharacterAdded:Connect(function(char)
            task.wait(0.5)
            if State.SkeletonESP then createSkeletonESP(char) end
        end))
        if player.Character then task.wait(0.5); createSkeletonESP(player.Character) end
    end))
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer then
            table.insert(skeletonConnections, player.CharacterAdded:Connect(function(char)
                task.wait(0.5)
                if State.SkeletonESP then createSkeletonESP(char) end
            end))
        end
    end
end

local function disableSkeletonESP()
    for _, c in pairs(skeletonConnections) do pcall(function() c:Disconnect() end) end
    skeletonConnections = {}
    for _, highlights in pairs(skeletonHighlights) do
        for _, hl in pairs(highlights) do if hl then hl:Destroy() end end
    end
    skeletonHighlights = {}
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  ESP HITBOX
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local hitboxConnections = {}
local hitboxParts       = {}
local ESP_HITBOX_COLOR  = Color3.fromRGB(0, 150, 255)

local function createHitboxESP(character)
    if not State.HitboxESP or not character then return end
    if hitboxParts[character] then return end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local hitbox = Instance.new("Part")
    hitbox.Name         = "HitboxESP"
    hitbox.Size         = Vector3.new(4, 6, 2)
    hitbox.Anchored     = false
    hitbox.CanCollide   = false
    hitbox.CanQuery     = false
    hitbox.CanTouch     = false
    hitbox.CastShadow   = false
    hitbox.Transparency = 0.7
    hitbox.Material     = Enum.Material.ForceField
    hitbox.Color        = ESP_HITBOX_COLOR
    hitbox.Parent       = workspace

    local weld = Instance.new("WeldConstraint")
    weld.Part0  = hitbox
    weld.Part1  = hrp
    weld.Parent = hitbox

    local hl = Instance.new("Highlight")
    hl.Adornee             = hitbox
    hl.FillColor           = ESP_HITBOX_COLOR
    hl.FillTransparency    = 0.5
    hl.OutlineColor        = ESP_HITBOX_COLOR
    hl.OutlineTransparency = 0
    hl.DepthMode           = Enum.HighlightDepthMode.AlwaysOnTop
    hl.Parent              = hitbox

    hitboxParts[character] = { hitbox = hitbox, highlight = hl }

    local function cleanup()
        if hitboxParts[character] then
            if hitboxParts[character].hitbox then hitboxParts[character].hitbox:Destroy() end
            hitboxParts[character] = nil
        end
    end

    local hum = character:FindFirstChildOfClass("Humanoid")
    if hum then table.insert(hitboxConnections, hum.Died:Connect(cleanup)) end
    table.insert(hitboxConnections, character.AncestryChanged:Connect(function(_, p)
        if not p then cleanup() end
    end))
end

local function enableHitboxESP()
    for _, c in pairs(hitboxConnections) do pcall(function() c:Disconnect() end) end
    hitboxConnections = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character then
            createHitboxESP(player.Character)
        end
    end
    table.insert(hitboxConnections, Players.PlayerAdded:Connect(function(player)
        if player == localPlayer then return end
        table.insert(hitboxConnections, player.CharacterAdded:Connect(function(char)
            task.wait(0.5)
            if State.HitboxESP then createHitboxESP(char) end
        end))
        if player.Character then task.wait(0.5); createHitboxESP(player.Character) end
    end))
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer then
            table.insert(hitboxConnections, player.CharacterAdded:Connect(function(char)
                task.wait(0.5)
                if State.HitboxESP then createHitboxESP(char) end
            end))
        end
    end
end

local function disableHitboxESP()
    for _, c in pairs(hitboxConnections) do pcall(function() c:Disconnect() end) end
    hitboxConnections = {}
    for _, data in pairs(hitboxParts) do
        if data and data.hitbox then data.hitbox:Destroy() end
    end
    hitboxParts = {}
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  SPEED BOOSTER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RunService.Heartbeat:Connect(function()
    if not State.SpeedBoost then return end
    local char = localPlayer.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hum or not hrp then return end
    if hum.MoveDirection.Magnitude > 0 then
        hrp.Velocity = Vector3.new(
            hum.MoveDirection.X * State.SpeedValue,
            hrp.Velocity.Y,
            hum.MoveDirection.Z * State.SpeedValue
        )
    end
    hum.UseJumpPower = true
    hum.JumpPower    = State.JumpValue
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  CERCLE INSTA GRAB
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local circleParts = {}
local PartsCount  = 65
local PART_COLOR  = Color3.fromRGB(0, 120, 255)

local function createCircle(char)
    for _, p in ipairs(circleParts) do if p then p:Destroy() end end
    circleParts = {}
    local root = char:WaitForChild("HumanoidRootPart", 5)
    if not root then return end
    local r = State.GrabRadius
    local points = {}
    for i = 0, PartsCount - 1 do
        local a = math.rad(i * 360 / PartsCount)
        table.insert(points, Vector3.new(math.cos(a), 0, math.sin(a)) * r)
    end
    for i = 1, #points do
        local ni = i % #points + 1
        local p1, p2 = points[i], points[ni]
        local part = Instance.new("Part")
        part.Anchored        = true
        part.CanCollide      = false
        part.Size            = Vector3.new((p2 - p1).Magnitude, 0.2, 0.3)
        part.Color           = PART_COLOR
        part.Material        = Enum.Material.Neon
        part.Transparency    = 0.3
        part.TopSurface      = Enum.SurfaceType.Smooth
        part.BottomSurface   = Enum.SurfaceType.Smooth
        part.Parent          = workspace
        table.insert(circleParts, part)
    end
end

local function updateCircle(char)
    local root = char:FindFirstChild("HumanoidRootPart")
    if not root then return end
    local r = State.GrabRadius
    local points = {}
    for i = 0, PartsCount - 1 do
        local a = math.rad(i * 360 / PartsCount)
        table.insert(points, Vector3.new(math.cos(a), 0, math.sin(a)) * r)
    end
    for i, part in ipairs(circleParts) do
        local ni = i % #points + 1
        local p1, p2 = points[i], points[ni]
        local center = (p1 + p2) / 2 + root.Position
        part.CFrame = CFrame.new(center, center + Vector3.new(p2.X - p1.X, 0, p2.Z - p1.Z)) * CFrame.Angles(0, math.pi / 2, 0)
    end
end

local function onCharAdded(char)
    if State.InstaGrab then
        createCircle(char)
        RunService:BindToRenderStep("CircleFollow", Enum.RenderPriority.Camera.Value + 1, function()
            updateCircle(char)
        end)
    end
    if State.AntiKnockback then enableAntiKnockback() end
end

if localPlayer.Character then onCharAdded(localPlayer.Character) end
localPlayer.CharacterAdded:Connect(onCharAdded)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  DÃ‰FINITIONS RÃ‰ELLES de syncUIWithState & applyLoadedEffects
--  âš ï¸ ICI â€” aprÃ¨s toutes les fonctions enable/disable
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
applyLoadedEffects = function()
    print("[SloDyZz] âš¡ Application des effets de la config...")
    if State.AntiKnockback then
        enableAntiKnockback()
        print("[SloDyZz] âœ… Anti Knockback restaurÃ©")
    end
    if State.InstaGrab then
        local char = localPlayer.Character
        if char then
            createCircle(char)
            RunService:BindToRenderStep("CircleFollow", Enum.RenderPriority.Camera.Value + 1, function()
                updateCircle(char)
            end)
            print("[SloDyZz] âœ… Insta Grab restaurÃ© (rayon: " .. State.GrabRadius .. ")")
        end
    end
    if State.AntiTrap then
        task.spawn(function() scanTraps(workspace) end)
        print("[SloDyZz] âœ… Anti Trap restaurÃ©")
    end
    if State.BaseESP    then enableBaseESP();     print("[SloDyZz] âœ… Base ESP restaurÃ©")     end
    if State.SkeletonESP then enableSkeletonESP(); print("[SloDyZz] âœ… Skeleton ESP restaurÃ©") end
    if State.HitboxESP  then enableHitboxESP();   print("[SloDyZz] âœ… Hitbox ESP restaurÃ©")   end
    print("[SloDyZz] ğŸ‰ Tous les effets appliquÃ©s!")
end

syncUIWithState = function()
    for key, funcs in pairs(UIReferences.toggles) do
        if State[key] ~= nil and funcs.setStateVisual then
            funcs.setStateVisual(State[key])
        end
    end
    for key, updateFn in pairs(UIReferences.sliders) do
        if key == "RangeStuds" then
            updateFn(rangeStuds)
        elseif State[key] ~= nil then
            updateFn(State[key])
        end
    end
    print("[SloDyZz] ğŸ”„ UI synchronisÃ©e")
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--                  INTERFACE GRAPHIQUE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local Theme = {
    Background   = Color3.fromRGB(15, 15, 25),
    Surface      = Color3.fromRGB(25, 25, 40),
    SurfaceLight = Color3.fromRGB(35, 35, 55),
    Primary      = Color3.fromRGB(0, 120, 255),
    Success      = Color3.fromRGB(67, 181, 129),
    Danger       = Color3.fromRGB(240, 71, 71),
    Warning      = Color3.fromRGB(250, 166, 26),
    Text         = Color3.fromRGB(255, 255, 255),
    TextMuted    = Color3.fromRGB(142, 146, 151),
    Accent1      = Color3.fromRGB(0, 120, 255),
    Accent2      = Color3.fromRGB(0, 200, 255),
}

local T = {  -- transparences
    Main    = 0.4,
    Surface = 0.5,
    Light   = 0.6,
    Header  = 0.3,
    Mark    = 0.5,
    Btn     = 0.5,
    Toggle  = 0.6,
}

-- Nettoyer ancienne UI
local playerGui = localPlayer:WaitForChild("PlayerGui")
for _, g in ipairs(playerGui:GetChildren()) do
    if g.Name == "SloDyZzHub" or g.Name == "PhantomHub" or g.Name == "GhostyHub"
    or g.Name == "AutoStealUI" or g.Name == "Verx_Toggles" then g:Destroy() end
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name             = "SloDyZzHub"
screenGui.ResetOnSpawn     = false
screenGui.ZIndexBehavior   = Enum.ZIndexBehavior.Sibling
screenGui.DisplayOrder     = 999999
screenGui.Parent           = playerGui

-- â”€â”€â”€ Helpers UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local function newCorner(parent, radius)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, radius or 12)
    c.Parent = parent
    return c
end

local function newStroke(parent, color, thickness, transparency)
    local s = Instance.new("UIStroke")
    s.Color        = color        or Color3.new(1,1,1)
    s.Thickness    = thickness    or 1
    s.Transparency = transparency or 0
    s.Parent       = parent
    return s
end

local function newPadding(parent, px)
    local p = Instance.new("UIPadding")
    p.PaddingLeft   = UDim.new(0, px)
    p.PaddingRight  = UDim.new(0, px)
    p.PaddingTop    = UDim.new(0, px)
    p.PaddingBottom = UDim.new(0, px)
    p.Parent        = parent
    return p
end

local function newListLayout(parent, padding, align)
    local l = Instance.new("UIListLayout")
    l.Padding             = UDim.new(0, padding or 10)
    l.SortOrder           = Enum.SortOrder.LayoutOrder
    l.HorizontalAlignment = align or Enum.HorizontalAlignment.Center
    l.Parent              = parent
    return l
end

-- â”€â”€â”€ Conteneur principal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local mainContainer = Instance.new("Frame")
mainContainer.Name                = "MainContainer"
mainContainer.Size                = UDim2.new(0, 540, 0, 650)
mainContainer.Position            = UDim2.new(0.5, -270, 0.5, -325)
mainContainer.BackgroundColor3    = Theme.Background
mainContainer.BackgroundTransparency = T.Main
mainContainer.BorderSizePixel     = 0
mainContainer.ClipsDescendants    = true
mainContainer.Parent              = screenGui
newCorner(mainContainer, 20)
newStroke(mainContainer, Theme.Primary, 2, 0.3)

local mainBlur = Instance.new("Frame")
mainBlur.Name                = "BlurEffect"
mainBlur.Size                = UDim2.new(1, 0, 1, 0)
mainBlur.BackgroundColor3    = Color3.fromRGB(0, 0, 0)
mainBlur.BackgroundTransparency = 0.7
mainBlur.BorderSizePixel     = 0
mainBlur.ZIndex              = -1
mainBlur.Parent              = mainContainer
newCorner(mainBlur, 20)

local mainShadow = Instance.new("ImageLabel")
mainShadow.Name               = "Shadow"
mainShadow.Size               = UDim2.new(1, 40, 1, 40)
mainShadow.Position           = UDim2.new(0.5, 0, 0.5, 0)
mainShadow.AnchorPoint        = Vector2.new(0.5, 0.5)
mainShadow.BackgroundTransparency = 1
mainShadow.Image              = "rbxassetid://6014261993"
mainShadow.ImageColor3        = Theme.Primary
mainShadow.ImageTransparency  = 0.7
mainShadow.ScaleType          = Enum.ScaleType.Slice
mainShadow.SliceCenter        = Rect.new(49, 49, 450, 450)
mainShadow.ZIndex             = -1
mainShadow.Parent             = mainContainer

-- â”€â”€â”€ Watermark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local watermark = Instance.new("Frame")
watermark.Name                = "Watermark"
watermark.Size                = UDim2.new(0, 340, 0, 95)
watermark.Position            = UDim2.new(0, 10, 0, 10)
watermark.BackgroundColor3    = Theme.Background
watermark.BackgroundTransparency = T.Mark
watermark.BorderSizePixel     = 0
watermark.Parent              = screenGui
newCorner(watermark, 12)
newStroke(watermark, Theme.Primary, 2, 0.3)

local wmTitle = Instance.new("TextLabel")
wmTitle.Size                  = UDim2.new(1, -20, 0, 22)
wmTitle.Position              = UDim2.new(0, 10, 0, 8)
wmTitle.BackgroundTransparency = 1
wmTitle.Text                  = "âš¡ SloDyZz HUB - Fusion Edition"
wmTitle.Font                  = Enum.Font.GothamBlack
wmTitle.TextSize              = 13
wmTitle.TextColor3            = Theme.Accent1
wmTitle.TextXAlignment        = Enum.TextXAlignment.Left
wmTitle.Parent                = watermark

local wmGradient = Instance.new("UIGradient")
wmGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0,   Theme.Accent1),
    ColorSequenceKeypoint.new(0.5, Theme.Accent2),
    ColorSequenceKeypoint.new(1,   Theme.Accent1),
})
wmGradient.Parent = wmTitle
task.spawn(function()
    while true do
        wmGradient.Rotation = (wmGradient.Rotation + 1) % 360
        task.wait(0.03)
    end
end)

local wmCredits = Instance.new("TextLabel")
wmCredits.Size                  = UDim2.new(1, -20, 0, 16)
wmCredits.Position              = UDim2.new(0, 10, 0, 30)
wmCredits.BackgroundTransparency = 1
wmCredits.Text                  = "By SloDyZz & Ghosty"
wmCredits.Font                  = Enum.Font.GothamBold
wmCredits.TextSize              = 10
wmCredits.TextColor3            = Theme.TextMuted
wmCredits.TextXAlignment        = Enum.TextXAlignment.Left
wmCredits.Parent                = watermark

local wmDiscord = Instance.new("TextLabel")
wmDiscord.Size                  = UDim2.new(1, -20, 0, 16)
wmDiscord.Position              = UDim2.new(0, 10, 0, 48)
wmDiscord.BackgroundTransparency = 1
wmDiscord.Text                  = "ğŸ’¬ discord.gg/TmevzZSkhp"
wmDiscord.Font                  = Enum.Font.GothamBold
wmDiscord.TextSize              = 10
wmDiscord.TextColor3            = Color3.fromRGB(88, 101, 242)
wmDiscord.TextXAlignment        = Enum.TextXAlignment.Left
wmDiscord.Parent                = watermark

local wmFPS = Instance.new("TextLabel")
wmFPS.Size                  = UDim2.new(0.3, 0, 0, 16)
wmFPS.Position              = UDim2.new(0, 10, 0, 68)
wmFPS.BackgroundTransparency = 1
wmFPS.Text                  = "FPS: --"
wmFPS.Font                  = Enum.Font.GothamBold
wmFPS.TextSize              = 10
wmFPS.TextColor3            = Theme.Success
wmFPS.TextXAlignment        = Enum.TextXAlignment.Left
wmFPS.Parent                = watermark

local wmPing = Instance.new("TextLabel")
wmPing.Size                  = UDim2.new(0.35, 0, 0, 16)
wmPing.Position              = UDim2.new(0.35, 0, 0, 68)
wmPing.BackgroundTransparency = 1
wmPing.Text                  = "Ping: --ms"
wmPing.Font                  = Enum.Font.GothamBold
wmPing.TextSize              = 10
wmPing.TextColor3            = Theme.Success
wmPing.TextXAlignment        = Enum.TextXAlignment.Left
wmPing.Parent                = watermark

-- â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local header = Instance.new("Frame")
header.Name                = "Header"
header.Size                = UDim2.new(1, 0, 0, 60)
header.BackgroundColor3    = Theme.Surface
header.BackgroundTransparency = T.Header
header.BorderSizePixel     = 0
header.Parent              = mainContainer
newCorner(header, 20)

local headerFix = Instance.new("Frame")
headerFix.Size                = UDim2.new(1, 0, 0.5, 0)
headerFix.Position            = UDim2.new(0, 0, 0.5, 0)
headerFix.BackgroundColor3    = Theme.Surface
headerFix.BackgroundTransparency = T.Header
headerFix.BorderSizePixel     = 0
headerFix.Parent              = header

local logo = Instance.new("TextLabel")
logo.Size                = UDim2.new(0, 40, 0, 40)
logo.Position            = UDim2.new(0, 15, 0.5, -20)
logo.BackgroundColor3    = Theme.Primary
logo.BackgroundTransparency = 0.1
logo.Text                = "âš¡"
logo.Font                = Enum.Font.GothamBold
logo.TextSize            = 24
logo.TextColor3          = Theme.Text
logo.BorderSizePixel     = 0
logo.Parent              = header
newCorner(logo, 10)

local titleLbl = Instance.new("TextLabel")
titleLbl.Size                = UDim2.new(0, 200, 0, 30)
titleLbl.Position            = UDim2.new(0, 65, 0, 8)
titleLbl.BackgroundTransparency = 1
titleLbl.Text                = "SloDyZz HUB"
titleLbl.Font                = Enum.Font.GothamBlack
titleLbl.TextSize            = 20
titleLbl.TextColor3          = Theme.Text
titleLbl.TextXAlignment      = Enum.TextXAlignment.Left
titleLbl.Parent              = header

local subtitle = Instance.new("TextLabel")
subtitle.Size                = UDim2.new(0, 200, 0, 18)
subtitle.Position            = UDim2.new(0, 65, 0, 35)
subtitle.BackgroundTransparency = 1
subtitle.Text                = "FUSION EDITION"
subtitle.Font                = Enum.Font.GothamBold
subtitle.TextSize            = 11
subtitle.TextColor3          = Theme.TextMuted
subtitle.TextXAlignment      = Enum.TextXAlignment.Left
subtitle.Parent              = header

local pingLabel = Instance.new("TextLabel")
pingLabel.Size                = UDim2.new(0, 80, 0, 25)
pingLabel.Position            = UDim2.new(1, -180, 0.5, -12)
pingLabel.BackgroundColor3    = Theme.SurfaceLight
pingLabel.BackgroundTransparency = T.Light
pingLabel.Text                = "-- ms"
pingLabel.Font                = Enum.Font.GothamBold
pingLabel.TextSize            = 12
pingLabel.TextColor3          = Theme.Success
pingLabel.BorderSizePixel     = 0
pingLabel.Parent              = header
newCorner(pingLabel, 8)

local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Size                = UDim2.new(0, 35, 0, 35)
minimizeBtn.Position            = UDim2.new(1, -50, 0.5, -17)
minimizeBtn.BackgroundColor3    = Theme.SurfaceLight
minimizeBtn.BackgroundTransparency = 0.2
minimizeBtn.Text                = "âˆ’"
minimizeBtn.Font                = Enum.Font.GothamBold
minimizeBtn.TextSize            = 20
minimizeBtn.TextColor3          = Theme.Text
minimizeBtn.BorderSizePixel     = 0
minimizeBtn.Parent              = header
newCorner(minimizeBtn, 10)

-- â”€â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local tabContainer = Instance.new("Frame")
tabContainer.Name                = "TabContainer"
tabContainer.Size                = UDim2.new(1, 0, 0, 50)
tabContainer.Position            = UDim2.new(0, 0, 0, 60)
tabContainer.BackgroundColor3    = Theme.Surface
tabContainer.BackgroundTransparency = 0.7
tabContainer.BorderSizePixel     = 0
tabContainer.Parent              = mainContainer

local tabLayout = Instance.new("UIListLayout")
tabLayout.FillDirection       = Enum.FillDirection.Horizontal
tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
tabLayout.VerticalAlignment   = Enum.VerticalAlignment.Center
tabLayout.Padding             = UDim.new(0, 5)
tabLayout.Parent              = tabContainer

-- â”€â”€â”€ Content area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local contentArea = Instance.new("ScrollingFrame")
contentArea.Name                    = "ContentArea"
contentArea.Size                    = UDim2.new(1, 0, 1, -110)
contentArea.Position                = UDim2.new(0, 0, 0, 110)
contentArea.BackgroundTransparency  = 1
contentArea.BorderSizePixel         = 0
contentArea.ScrollBarThickness      = 6
contentArea.ScrollBarImageColor3    = Theme.Primary
contentArea.ScrollBarImageTransparency = 0.3
contentArea.CanvasSize              = UDim2.new(0, 0, 0, 0)
contentArea.AutomaticCanvasSize     = Enum.AutomaticSize.Y
contentArea.ScrollingDirection      = Enum.ScrollingDirection.Y
contentArea.Parent                  = mainContainer
newPadding(contentArea, 15)
newListLayout(contentArea, 10)

-- â”€â”€â”€ Pages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local pages = {}
local currentPage = nil

local function createTab(name, icon, order)
    local tab = Instance.new("TextButton")
    tab.Name                = name .. "Tab"
    tab.Size                = UDim2.new(0, 100, 0, 38)
    tab.BackgroundColor3    = Theme.SurfaceLight
    tab.BackgroundTransparency = 0.4
    tab.Text                = icon .. " " .. name
    tab.Font                = Enum.Font.GothamBold
    tab.TextSize            = 11
    tab.TextColor3          = Theme.TextMuted
    tab.BorderSizePixel     = 0
    tab.LayoutOrder         = order
    tab.Parent              = tabContainer
    newCorner(tab, 10)
    local ts = newStroke(tab, Theme.Primary, 0, 1)
    return tab, ts
end

local function createPage(name)
    local page = Instance.new("Frame")
    page.Name                = name .. "Page"
    page.Size                = UDim2.new(1, 0, 0, 0)   -- hauteur dynamique
    page.AutomaticSize       = Enum.AutomaticSize.Y     -- grandit selon le contenu
    page.BackgroundTransparency = 1
    page.BorderSizePixel     = 0
    page.Visible             = false
    page.Parent              = contentArea
    newListLayout(page, 10)
    pages[name] = page
    return page
end

local function switchPage(pageName)
    for name, page in pairs(pages) do page.Visible = (name == pageName) end
    currentPage = pageName
end

local protectionTab, protectionStroke = createTab("Protection", "ğŸ›¡", 1)
local grabTab,        grabStroke       = createTab("Insta Grab", "âš¡", 2)
local boostTab,       boostStroke      = createTab("Boost",      "ğŸ’¨", 3)
local espTab,         espStroke        = createTab("ESP",        "ğŸ‘", 4)
local playersTab,     playersStroke    = createTab("Joueurs",    "ğŸ‘¥", 5)

local protectionPage = createPage("Protection")
local grabPage       = createPage("Grab")
local boostPage      = createPage("Boost")
local espPage        = createPage("ESP")
local playersPage    = createPage("Players")

-- â”€â”€â”€ Composants UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local function createSection(parent, title, order)
    local section = Instance.new("Frame")
    section.Name                = "Section_" .. title
    section.Size                = UDim2.new(1, 0, 0, 0)
    section.AutomaticSize       = Enum.AutomaticSize.Y
    section.BackgroundColor3    = Theme.Surface
    section.BackgroundTransparency = T.Surface
    section.BorderSizePixel     = 0
    section.LayoutOrder         = order
    section.Parent              = parent
    newCorner(section, 15)
    newStroke(section, Theme.Primary, 1, 0.7)
    newPadding(section, 15)
    newListLayout(section, 10)

    local titleLbl2 = Instance.new("TextLabel")
    titleLbl2.Name                = "Title"
    titleLbl2.Size                = UDim2.new(1, 0, 0, 25)
    titleLbl2.BackgroundTransparency = 1
    titleLbl2.Text                = title
    titleLbl2.Font                = Enum.Font.GothamBold
    titleLbl2.TextSize            = 14
    titleLbl2.TextColor3          = Theme.Text
    titleLbl2.TextXAlignment      = Enum.TextXAlignment.Left
    titleLbl2.LayoutOrder         = 0
    titleLbl2.Parent              = section
    return section
end

local function createToggle(parent, label, description, order, callback)
    local toggle = Instance.new("Frame")
    toggle.Name                = "Toggle_" .. label
    toggle.Size                = UDim2.new(1, 0, 0, description and 60 or 45)
    toggle.BackgroundColor3    = Theme.SurfaceLight
    toggle.BackgroundTransparency = T.Toggle
    toggle.BorderSizePixel     = 0
    toggle.LayoutOrder         = order
    toggle.Parent              = parent
    newCorner(toggle, 12)

    local lbl = Instance.new("TextLabel")
    lbl.Size                = UDim2.new(1, -80, 0, 22)
    lbl.Position            = UDim2.new(0, 12, 0, description and 8 or 11)
    lbl.BackgroundTransparency = 1
    lbl.Text                = label
    lbl.Font                = Enum.Font.GothamBold
    lbl.TextSize            = 13
    lbl.TextColor3          = Theme.Text
    lbl.TextXAlignment      = Enum.TextXAlignment.Left
    lbl.Parent              = toggle

    if description then
        local desc = Instance.new("TextLabel")
        desc.Size                = UDim2.new(1, -80, 0, 18)
        desc.Position            = UDim2.new(0, 12, 0, 32)
        desc.BackgroundTransparency = 1
        desc.Text                = description
        desc.Font                = Enum.Font.Gotham
        desc.TextSize            = 10
        desc.TextColor3          = Theme.TextMuted
        desc.TextXAlignment      = Enum.TextXAlignment.Left
        desc.TextWrapped         = true
        desc.Parent              = toggle
    end

    local switchBg = Instance.new("TextButton")
    switchBg.Size                = UDim2.new(0, 50, 0, 26)
    switchBg.Position            = UDim2.new(1, -58, 0.5, -13)
    switchBg.BackgroundColor3    = Theme.Danger
    switchBg.BackgroundTransparency = 0.2
    switchBg.Text                = ""
    switchBg.BorderSizePixel     = 0
    switchBg.Parent              = toggle
    newCorner(switchBg, 100)

    local switchDot = Instance.new("Frame")
    switchDot.Size            = UDim2.new(0, 20, 0, 20)
    switchDot.Position        = UDim2.new(0, 3, 0.5, -10)
    switchDot.BackgroundColor3 = Theme.Text
    switchDot.BorderSizePixel = 0
    switchDot.Parent          = switchBg
    newCorner(switchDot, 100)

    local togState = false

    local function setState(enabled)
        togState = enabled
        TweenService:Create(switchDot, TweenInfo.new(0.2, Enum.EasingStyle.Quart), {
            Position = enabled and UDim2.new(1, -23, 0.5, -10) or UDim2.new(0, 3, 0.5, -10)
        }):Play()
        TweenService:Create(switchBg, TweenInfo.new(0.2), {
            BackgroundColor3 = enabled and Theme.Success or Theme.Danger
        }):Play()
        if callback then callback(enabled) end
    end

    -- setStateVisual : mÃªme animation mais sans dÃ©clencher le callback
    local function setStateVisual(enabled)
        togState = enabled
        TweenService:Create(switchDot, TweenInfo.new(0.2, Enum.EasingStyle.Quart), {
            Position = enabled and UDim2.new(1, -23, 0.5, -10) or UDim2.new(0, 3, 0.5, -10)
        }):Play()
        TweenService:Create(switchBg, TweenInfo.new(0.2), {
            BackgroundColor3 = enabled and Theme.Success or Theme.Danger
        }):Play()
    end

    switchBg.MouseButton1Click:Connect(function() setState(not togState) end)
    return toggle, setState, setStateVisual
end

local function createToggleWithRef(parent, label, description, order, stateKey, callback)
    local toggle, setState, setStateVisual = createToggle(parent, label, description, order, callback)
    UIReferences.toggles[stateKey] = { setState = setState, setStateVisual = setStateVisual }
    return toggle, setState
end

local function createButton(parent, label, color, order, callback)
    local btn = Instance.new("TextButton")
    btn.Name                = "Btn_" .. label
    btn.Size                = UDim2.new(1, 0, 0, 42)
    btn.BackgroundColor3    = color or Theme.Primary
    btn.BackgroundTransparency = T.Btn
    btn.Text                = label
    btn.Font                = Enum.Font.GothamBold
    btn.TextSize            = 13
    btn.TextColor3          = Theme.Text
    btn.BorderSizePixel     = 0
    btn.LayoutOrder         = order
    btn.Parent              = parent
    newCorner(btn, 12)
    newStroke(btn, color or Theme.Primary, 1, 0.5)
    btn.MouseButton1Click:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.1), { BackgroundTransparency = 0.2 }):Play()
        task.wait(0.1)
        TweenService:Create(btn, TweenInfo.new(0.1), { BackgroundTransparency = T.Btn }):Play()
        if callback then callback() end
    end)
    return btn
end

local function createSlider(parent, label, minV, maxV, default, order, callback)
    local container = Instance.new("Frame")
    container.Name                = "Slider_" .. label
    container.Size                = UDim2.new(1, 0, 0, 55)
    container.BackgroundColor3    = Theme.SurfaceLight
    container.BackgroundTransparency = T.Toggle
    container.BorderSizePixel     = 0
    container.LayoutOrder         = order
    container.Parent              = parent
    newCorner(container, 12)

    local slLbl = Instance.new("TextLabel")
    slLbl.Size                = UDim2.new(0.6, 0, 0, 25)
    slLbl.Position            = UDim2.new(0, 12, 0, 5)
    slLbl.BackgroundTransparency = 1
    slLbl.Text                = label
    slLbl.Font                = Enum.Font.GothamBold
    slLbl.TextSize            = 12
    slLbl.TextColor3          = Theme.Text
    slLbl.TextXAlignment      = Enum.TextXAlignment.Left
    slLbl.Parent              = container

    local valLbl = Instance.new("TextLabel")
    valLbl.Size                = UDim2.new(0, 60, 0, 25)
    valLbl.Position            = UDim2.new(1, -70, 0, 5)
    valLbl.BackgroundColor3    = Theme.Surface
    valLbl.BackgroundTransparency = T.Light
    valLbl.Text                = tostring(default)
    valLbl.Font                = Enum.Font.GothamBold
    valLbl.TextSize            = 12
    valLbl.TextColor3          = Theme.Accent1
    valLbl.BorderSizePixel     = 0
    valLbl.Parent              = container
    newCorner(valLbl, 8)

    local slBg = Instance.new("Frame")
    slBg.Size            = UDim2.new(1, -24, 0, 4)
    slBg.Position        = UDim2.new(0, 12, 1, -15)
    slBg.BackgroundColor3 = Theme.Surface
    slBg.BorderSizePixel = 0
    slBg.Parent          = container
    newCorner(slBg, 100)

    local slFill = Instance.new("Frame")
    slFill.Size            = UDim2.new((default - minV) / (maxV - minV), 0, 1, 0)
    slFill.BackgroundColor3 = Theme.Primary
    slFill.BorderSizePixel = 0
    slFill.Parent          = slBg
    newCorner(slFill, 100)

    local slDot = Instance.new("Frame")
    slDot.Size            = UDim2.new(0, 14, 0, 14)
    slDot.Position        = UDim2.new((default - minV) / (maxV - minV), -7, 0.5, -7)
    slDot.BackgroundColor3 = Theme.Text
    slDot.BorderSizePixel = 0
    slDot.Parent          = slBg
    newCorner(slDot, 100)

    local dragging = false
    local function updateSlider(value)
        value = math.clamp(value, minV, maxV)
        local pct = (value - minV) / (maxV - minV)
        TweenService:Create(slFill, TweenInfo.new(0.1), { Size = UDim2.new(pct, 0, 1, 0) }):Play()
        TweenService:Create(slDot,  TweenInfo.new(0.1), { Position = UDim2.new(pct, -7, 0.5, -7) }):Play()
        valLbl.Text = tostring(math.floor(value))
        if callback then callback(value) end
    end

    slBg.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            local rel = math.clamp((input.Position.X - slBg.AbsolutePosition.X) / slBg.AbsoluteSize.X, 0, 1)
            updateSlider(minV + (maxV - minV) * rel)
        end
    end)
    slBg.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local rel = math.clamp((input.Position.X - slBg.AbsolutePosition.X) / slBg.AbsoluteSize.X, 0, 1)
            updateSlider(minV + (maxV - minV) * rel)
        end
    end)
    return container, updateSlider
end

local function createSliderWithRef(parent, label, minV, maxV, default, order, stateKey, callback)
    local slider, updateFn = createSlider(parent, label, minV, maxV, default, order, callback)
    UIReferences.sliders[stateKey] = updateFn
    return slider, updateFn
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  PAGE PROTECTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local protSection = createSection(protectionPage, "ğŸ›¡ Protections", 1)

createToggleWithRef(protSection, "Steal Bar 50% â†’ Leave", "Quitte si barre de vol â‰¥ 50%", 1, "StealBar", function(on)
    State.StealBar = on
end)

createToggleWithRef(protSection, "Anti Scam", "Quitte si un joueur s'approche de ton podium", 2, "AntiScam", function(on)
    State.AntiScam = on
    if on and not myPlot then
        myPlot = findMyPlot()
        if myPlot then myPlotPodiums = getAnimalPodiums(myPlot) end
    end
end)

createToggleWithRef(protSection, "Auto Defense (Kick)", "Kick le joueur sÃ©lectionnÃ© si vol dÃ©tectÃ©", 3, "AutoDefense", function(on)
    State.AutoDefense = on
end)

createToggleWithRef(protSection, "Auto Leave Defender", "Quitte automatiquement si vol dÃ©tectÃ©", 4, "AutoLeave", function(on)
    State.AutoLeave = on
end)

createToggleWithRef(protSection, "Anti Knockback / Ragdoll", "Bloque knockback, ragdoll et effets physiques", 5, "AntiKnockback", function(on)
    State.AntiKnockback = on
    if on then enableAntiKnockback() else disableAntiKnockback() end
end)

createToggleWithRef(protSection, "Anti Trap", "CrÃ©e une barriÃ¨re verte autour des piÃ¨ges", 6, "AntiTrap", function(on)
    State.AntiTrap = on
    if on then task.spawn(function() scanTraps(workspace) end) end
end)

createSliderWithRef(protSection, "Range DÃ©tection (studs)", 1, 50, rangeStuds, 7, "RangeStuds", function(v)
    rangeStuds = v
end)

createButton(protSection, "ğŸ” DÃ©tecter mon Plot", Theme.Primary, 8, function()
    myPlot = findMyPlot()
    if myPlot then
        myPlotPodiums = getAnimalPodiums(myPlot)
        print("[SloDyZz] Plot dÃ©tectÃ©: " .. myPlot.Name)
    else
        print("[SloDyZz] Plot introuvable!")
    end
end)

-- â”€â”€â”€ Section Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local cfgSection = createSection(protectionPage, "ğŸ’¾ Configuration", 2)

local cfgInfoFrame = Instance.new("Frame")
cfgInfoFrame.Name                = "ConfigInfo"
cfgInfoFrame.Size                = UDim2.new(1, 0, 0, 55)
cfgInfoFrame.BackgroundColor3    = Theme.SurfaceLight
cfgInfoFrame.BackgroundTransparency = T.Light
cfgInfoFrame.BorderSizePixel     = 0
cfgInfoFrame.LayoutOrder         = 1
cfgInfoFrame.Parent              = cfgSection
newCorner(cfgInfoFrame, 12)

local cfgIcon = Instance.new("TextLabel")
cfgIcon.Size                = UDim2.new(0, 30, 0, 30)
cfgIcon.Position            = UDim2.new(0, 10, 0, 12)
cfgIcon.BackgroundTransparency = 1
cfgIcon.Text                = "ğŸ’¾"
cfgIcon.Font                = Enum.Font.GothamBold
cfgIcon.TextSize            = 20
cfgIcon.Parent              = cfgInfoFrame

local cfgInfoText = Instance.new("TextLabel")
cfgInfoText.Size                = UDim2.new(1, -55, 0, 45)
cfgInfoText.Position            = UDim2.new(0, 48, 0, 5)
cfgInfoText.BackgroundTransparency = 1
cfgInfoText.Text                = "Config sauvegardÃ©e dans : workspace/SloDyZzHub/config.json\nChargement automatique Ã  chaque session."
cfgInfoText.Font                = Enum.Font.Gotham
cfgInfoText.TextSize            = 10
cfgInfoText.TextColor3          = Theme.TextMuted
cfgInfoText.TextXAlignment      = Enum.TextXAlignment.Left
cfgInfoText.TextYAlignment      = Enum.TextYAlignment.Top
cfgInfoText.TextWrapped         = true
cfgInfoText.Parent              = cfgInfoFrame

local saveBtn = createButton(cfgSection, "ğŸ’¾ Sauvegarder la Configuration", Theme.Success, 2, function()
    local ok = saveConfig()
    saveBtn.Text = ok and "âœ… SauvegardÃ©!" or "âŒ Erreur"
    task.delay(2, function()
        if saveBtn and saveBtn.Parent then saveBtn.Text = "ğŸ’¾ Sauvegarder la Configuration" end
    end)
end)

local loadBtn = createButton(cfgSection, "ğŸ“‚ Charger la Configuration", Theme.Primary, 3, function()
    local cfg = loadConfig()
    if cfg then
        applyConfig(cfg)
        task.wait(0.1); syncUIWithState()
        task.wait(0.1); applyLoadedEffects()
        loadBtn.Text = "âœ… ChargÃ©!"
        print("[SloDyZz] âœ… Config rechargÃ©e manuellement")
    else
        loadBtn.Text = "âŒ Aucune Config TrouvÃ©e"
        print("[SloDyZz] âŒ Aucune config trouvÃ©e")
    end
    task.delay(2, function()
        if loadBtn and loadBtn.Parent then loadBtn.Text = "ğŸ“‚ Charger la Configuration" end
    end)
end)

local resetBtn = createButton(cfgSection, "ğŸ”„ RÃ©initialiser aux Valeurs par DÃ©faut", Theme.Warning, 4, function()
    State.StealBar      = false
    State.AntiScam      = false
    State.AutoDefense   = false
    State.AutoLeave     = false
    State.AntiKnockback = false
    disableAntiKnockback()
    State.AntiTrap      = false
    rangeStuds          = 9
    State.InstaGrab     = false
    RunService:UnbindFromRenderStep("CircleFollow")
    for _, p in ipairs(circleParts) do if p then p:Destroy() end end
    circleParts         = {}
    State.GrabRadius    = 20
    State.SpeedBoost    = false
    State.SpeedValue    = 22.5
    State.JumpValue     = 35
    State.BaseESP       = false
    disableBaseESP()
    State.SkeletonESP   = false
    disableSkeletonESP()
    State.HitboxESP     = false
    disableHitboxESP()
    syncUIWithState()
    resetBtn.Text = "âœ… RÃ©initialisÃ©!"
    print("[SloDyZz] â™»ï¸ RÃ©initialisÃ© aux valeurs par dÃ©faut")
    task.delay(2, function()
        if resetBtn and resetBtn.Parent then resetBtn.Text = "ğŸ”„ RÃ©initialiser aux Valeurs par DÃ©faut" end
    end)
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  PAGE INSTA GRAB
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local grabSection = createSection(grabPage, "âš¡ Insta Grab", 1)

createToggleWithRef(grabSection, "INSTA GRAB", "Active le vol automatique d'animaux", 1, "InstaGrab", function(on)
    State.InstaGrab = on
    if on then
        local char = localPlayer.Character
        if char then
            createCircle(char)
            RunService:BindToRenderStep("CircleFollow", Enum.RenderPriority.Camera.Value + 1, function()
                updateCircle(char)
            end)
        end
    else
        RunService:UnbindFromRenderStep("CircleFollow")
        for _, p in ipairs(circleParts) do if p then p:Destroy() end end
        circleParts = {}
    end
end)

local _, updateGrabRadius = createSliderWithRef(grabSection, "Rayon de Grab (studs)", 5, 200, State.GrabRadius, 2, "GrabRadius", function(v)
    State.GrabRadius = v
    local char = localPlayer.Character
    if char and State.InstaGrab then createCircle(char) end
end)

-- Barre de progression du steal
local progressFrame = Instance.new("Frame")
progressFrame.Name                = "ProgressFrame"
progressFrame.Size                = UDim2.new(1, 0, 0, 35)
progressFrame.BackgroundColor3    = Theme.SurfaceLight
progressFrame.BackgroundTransparency = T.Light
progressFrame.BorderSizePixel     = 0
progressFrame.LayoutOrder         = 3
progressFrame.Parent              = grabSection
newCorner(progressFrame, 12)

local progressLbl = Instance.new("TextLabel")
progressLbl.Size                = UDim2.new(0.4, 0, 1, 0)
progressLbl.Position            = UDim2.new(0, 12, 0, 0)
progressLbl.BackgroundTransparency = 1
progressLbl.Text                = "Progression:"
progressLbl.Font                = Enum.Font.GothamBold
progressLbl.TextSize            = 11
progressLbl.TextColor3          = Theme.Text
progressLbl.TextXAlignment      = Enum.TextXAlignment.Left
progressLbl.Parent              = progressFrame

local progBg = Instance.new("Frame")
progBg.Size            = UDim2.new(0.55, 0, 0, 8)
progBg.Position        = UDim2.new(0.43, 0, 0.5, -4)
progBg.BackgroundColor3 = Theme.Surface
progBg.BorderSizePixel = 0
progBg.Parent          = progressFrame
newCorner(progBg, 100)

local progFill = Instance.new("Frame")
progFill.Size            = UDim2.new(0, 0, 1, 0)
progFill.BackgroundColor3 = Theme.Accent1
progFill.BorderSizePixel = 0
progFill.Parent          = progBg
newCorner(progFill, 100)

local progGrad = Instance.new("UIGradient")
progGrad.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0,   Theme.Accent1),
    ColorSequenceKeypoint.new(0.5, Theme.Accent2),
    ColorSequenceKeypoint.new(1,   Theme.Accent1),
})
progGrad.Parent = progFill

task.spawn(function()
    while task.wait(0.03) do
        local target = IsStealing and StealProgress or math.max(0, (progFill.Size.X.Scale or 0) - 0.03)
        TweenService:Create(progFill, TweenInfo.new(0.1, Enum.EasingStyle.Linear), {
            Size = UDim2.new(target, 0, 1, 0)
        }):Play()
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  PAGE BOOST
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local boostSection = createSection(boostPage, "ğŸ’¨ Speed Booster", 1)

createToggleWithRef(boostSection, "Speed & Jump Boost", "Active l'augmentation de vitesse et de saut", 1, "SpeedBoost", function(on)
    State.SpeedBoost = on
end)

local _, updateSpeed = createSliderWithRef(boostSection, "Vitesse", 16, 50, State.SpeedValue, 2, "SpeedValue", function(v)
    State.SpeedValue = v
end)

local _, updateJump = createSliderWithRef(boostSection, "Puissance de Saut", 35, 100, State.JumpValue, 3, "JumpValue", function(v)
    State.JumpValue = v
end)

createButton(boostSection, "âš¡ Preset Speed 29 (RecommandÃ©)", Theme.Success, 4, function()
    State.SpeedValue = 29
    State.JumpValue  = 50
    updateSpeed(29)
    updateJump(50)
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  PAGE ESP
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local espSection = createSection(espPage, "ğŸ‘ ESP & Visuals", 1)

createToggleWithRef(espSection, "Base ESP with Timer", "Affiche le timer des bases ennemies", 1, "BaseESP", function(on)
    State.BaseESP = on
    if on then enableBaseESP() else disableBaseESP() end
end)

createToggleWithRef(espSection, "Skeleton ESP (Bleu)", "Highlight bleu sur toutes les parties du corps", 2, "SkeletonESP", function(on)
    State.SkeletonESP = on
    if on then enableSkeletonESP() else disableSkeletonESP() end
end)

createToggleWithRef(espSection, "Hitbox ESP (Bleu)", "Hitbox bleue transparente autour des joueurs", 3, "HitboxESP", function(on)
    State.HitboxESP = on
    if on then enableHitboxESP() else disableHitboxESP() end
end)

local espInfoFrame = Instance.new("Frame")
espInfoFrame.Name                = "EspInfo"
espInfoFrame.Size                = UDim2.new(1, 0, 0, 90)
espInfoFrame.BackgroundColor3    = Theme.SurfaceLight
espInfoFrame.BackgroundTransparency = T.Light
espInfoFrame.BorderSizePixel     = 0
espInfoFrame.LayoutOrder         = 4
espInfoFrame.Parent              = espSection
newCorner(espInfoFrame, 12)

local espInfoIcon = Instance.new("TextLabel")
espInfoIcon.Size                = UDim2.new(0, 30, 0, 30)
espInfoIcon.Position            = UDim2.new(0, 10, 0, 10)
espInfoIcon.BackgroundTransparency = 1
espInfoIcon.Text                = "â„¹ï¸"
espInfoIcon.Font                = Enum.Font.GothamBold
espInfoIcon.TextSize            = 20
espInfoIcon.Parent              = espInfoFrame

local espInfoTitle = Instance.new("TextLabel")
espInfoTitle.Size                = UDim2.new(1, -55, 0, 20)
espInfoTitle.Position            = UDim2.new(0, 45, 0, 8)
espInfoTitle.BackgroundTransparency = 1
espInfoTitle.Text                = "ESP Information"
espInfoTitle.Font                = Enum.Font.GothamBold
espInfoTitle.TextSize            = 12
espInfoTitle.TextColor3          = Theme.Text
espInfoTitle.TextXAlignment      = Enum.TextXAlignment.Left
espInfoTitle.Parent              = espInfoFrame

local espInfoDesc = Instance.new("TextLabel")
espInfoDesc.Size                = UDim2.new(1, -55, 0, 55)
espInfoDesc.Position            = UDim2.new(0, 45, 0, 30)
espInfoDesc.BackgroundTransparency = 1
espInfoDesc.Text                = "Base ESP: Timers des bases ennemies\nSkeleton ESP: Highlight BLEU sur corps entier\nHitbox ESP: Hitbox bleue transparente (4x6x2)"
espInfoDesc.Font                = Enum.Font.Gotham
espInfoDesc.TextSize            = 10
espInfoDesc.TextColor3          = Theme.TextMuted
espInfoDesc.TextXAlignment      = Enum.TextXAlignment.Left
espInfoDesc.TextYAlignment      = Enum.TextYAlignment.Top
espInfoDesc.TextWrapped         = true
espInfoDesc.Parent              = espInfoFrame

local espCfgSection = createSection(espPage, "âš™ï¸ Config Rapide", 2)

createButton(espCfgSection, "ğŸ¯ Activer Tous les ESP", Theme.Success, 1, function()
    State.BaseESP = true; State.SkeletonESP = true; State.HitboxESP = true
    enableBaseESP(); enableSkeletonESP(); enableHitboxESP()
    syncUIWithState()
    print("[SloDyZz] âœ… Tous les ESP activÃ©s!")
end)

createButton(espCfgSection, "ğŸš« DÃ©sactiver Tous les ESP", Theme.Danger, 2, function()
    State.BaseESP = false; State.SkeletonESP = false; State.HitboxESP = false
    disableBaseESP(); disableSkeletonESP(); disableHitboxESP()
    syncUIWithState()
    print("[SloDyZz] âŒ Tous les ESP dÃ©sactivÃ©s!")
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  PAGE JOUEURS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local plrSection = createSection(playersPage, "ğŸ‘¥ Gestion des Joueurs", 1)

local selLabel = Instance.new("TextLabel")
selLabel.Size                = UDim2.new(1, 0, 0, 25)
selLabel.BackgroundTransparency = 1
selLabel.Text                = "0 joueur(s) sÃ©lectionnÃ©(s) (max 2)"
selLabel.Font                = Enum.Font.Gotham
selLabel.TextSize            = 11
selLabel.TextColor3          = Theme.TextMuted
selLabel.TextXAlignment      = Enum.TextXAlignment.Left
selLabel.LayoutOrder         = 1
selLabel.Parent              = plrSection

local function updateSelLabel()
    selLabel.Text = #selectedPlayers .. " joueur(s) sÃ©lectionnÃ©(s) (max 2)"
end

local playerListFrame = Instance.new("Frame")
playerListFrame.Name                = "PlayerList"
playerListFrame.Size                = UDim2.new(1, 0, 0, 0)
playerListFrame.AutomaticSize       = Enum.AutomaticSize.Y
playerListFrame.BackgroundTransparency = 1
playerListFrame.LayoutOrder         = 2
playerListFrame.Parent              = plrSection

local pllayout = Instance.new("UIListLayout")
pllayout.Padding     = UDim.new(0, 8)
pllayout.SortOrder   = Enum.SortOrder.Name
pllayout.Parent      = playerListFrame

local function createPlayerRow(player)
    local row = Instance.new("Frame")
    row.Name                = player.Name .. "_row"
    row.Size                = UDim2.new(1, 0, 0, 60)
    row.BackgroundColor3    = Theme.SurfaceLight
    row.BackgroundTransparency = T.Toggle
    row.BorderSizePixel     = 0
    row.Parent              = playerListFrame
    newCorner(row, 12)
    newStroke(row, Theme.Primary, 1, 0.8)
    local selStroke = newStroke(row, Theme.Success, 2, 1)

    local av = Instance.new("ImageLabel")
    av.Size            = UDim2.new(0, 40, 0, 40)
    av.Position        = UDim2.new(0, 10, 0.5, -20)
    av.BackgroundColor3 = Theme.Surface
    av.BorderSizePixel = 0
    av.Parent          = row
    newCorner(av, 20)
    task.spawn(function()
        local ok, thumb = pcall(function()
            return Players:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
        end)
        if ok and thumb then av.Image = thumb end
    end)

    local dn = Instance.new("TextLabel")
    dn.Size                = UDim2.new(0, 200, 0, 20)
    dn.Position            = UDim2.new(0, 60, 0, 12)
    dn.BackgroundTransparency = 1
    dn.Text                = player.DisplayName
    dn.Font                = Enum.Font.GothamBold
    dn.TextSize            = 13
    dn.TextColor3          = Theme.Text
    dn.TextXAlignment      = Enum.TextXAlignment.Left
    dn.Parent              = row

    local un = Instance.new("TextLabel")
    un.Size                = UDim2.new(0, 200, 0, 16)
    un.Position            = UDim2.new(0, 60, 0, 32)
    un.BackgroundTransparency = 1
    un.Text                = "@" .. player.Name
    un.Font                = Enum.Font.Gotham
    un.TextSize            = 10
    un.TextColor3          = Theme.TextMuted
    un.TextXAlignment      = Enum.TextXAlignment.Left
    un.Parent              = row

    local kickBtn = Instance.new("TextButton")
    kickBtn.Size                = UDim2.new(0, 60, 0, 32)
    kickBtn.Position            = UDim2.new(1, -70, 0.5, -16)
    kickBtn.BackgroundColor3    = Theme.Danger
    kickBtn.BackgroundTransparency = 0.2
    kickBtn.Text                = "KICK"
    kickBtn.Font                = Enum.Font.GothamBold
    kickBtn.TextSize            = 11
    kickBtn.TextColor3          = Theme.Text
    kickBtn.BorderSizePixel     = 0
    kickBtn.Parent              = row
    newCorner(kickBtn, 10)

    kickBtn.MouseButton1Click:Connect(function()
        if not remoteReady then return end
        pcall(function()
            NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", player, "kick")
        end)
        kickBtn.Text = "âœ“"; kickBtn.BackgroundColor3 = Theme.Success
        task.delay(1.2, function()
            if kickBtn.Parent then kickBtn.Text = "KICK"; kickBtn.BackgroundColor3 = Theme.Danger end
        end)
    end)

    local isSelected = false
    row.InputBegan:Connect(function(input)
        if input.UserInputType ~= Enum.UserInputType.MouseButton1 and input.UserInputType ~= Enum.UserInputType.Touch then return end
        if input.Position.X > row.AbsolutePosition.X + row.AbsoluteSize.X - 80 then return end
        if isSelected then
            isSelected = false
            selectedUserIds[player.UserId] = nil
            for i, p in ipairs(selectedPlayers) do
                if p == player then table.remove(selectedPlayers, i); break end
            end
            TweenService:Create(row,       TweenInfo.new(0.15), { BackgroundColor3 = Theme.SurfaceLight }):Play()
            TweenService:Create(selStroke, TweenInfo.new(0.15), { Transparency = 1 }):Play()
        else
            if #selectedPlayers < 2 then
                isSelected = true
                table.insert(selectedPlayers, player)
                selectedUserIds[player.UserId] = #selectedPlayers
                TweenService:Create(row,       TweenInfo.new(0.15), { BackgroundColor3 = Theme.Surface }):Play()
                TweenService:Create(selStroke, TweenInfo.new(0.15), { Transparency = 0 }):Play()
            end
        end
        updateSelLabel()
    end)
end

local function refreshPlayerList()
    for _, child in ipairs(playerListFrame:GetChildren()) do
        if child:IsA("Frame") then child:Destroy() end
    end
    selectedPlayers = {}; selectedUserIds = {}; updateSelLabel()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer then createPlayerRow(player) end
    end
end

task.spawn(function()
    while not remoteReady do task.wait(0.2) end
    task.wait(0.3); refreshPlayerList()
end)

Players.PlayerAdded:Connect(function()   task.wait(0.5); refreshPlayerList() end)
Players.PlayerRemoving:Connect(function() task.wait(0.1); refreshPlayerList() end)
localPlayer.CharacterAdded:Connect(function() task.wait(1); refreshPlayerList() end)

local actSection = createSection(playersPage, "âš¡ Actions Rapides", 2)

createButton(actSection, "âš¡ Kick SÃ©lectionnÃ©(s) [F]", Theme.Danger, 1, function()
    if not remoteReady then return end
    for _, player in ipairs(selectedPlayers) do
        if player and player.Parent == Players then
            pcall(function()
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", player, "kick")
            end)
            task.wait(0.05)
        end
    end
end)

createButton(actSection, "ğŸšª Quitter le Jeu",      Theme.Danger,   2, function() leaveGame() end)
createButton(actSection, "ğŸ”„ RafraÃ®chir la Liste", Theme.Primary,  3, function() refreshPlayerList() end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  GESTION DES TABS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local tabDefs = {
    { button = protectionTab, stroke = protectionStroke, page = "Protection" },
    { button = grabTab,       stroke = grabStroke,       page = "Grab"       },
    { button = boostTab,      stroke = boostStroke,      page = "Boost"      },
    { button = espTab,        stroke = espStroke,        page = "ESP"        },
    { button = playersTab,    stroke = playersStroke,    page = "Players"    },
}

for _, tab in ipairs(tabDefs) do
    tab.button.MouseButton1Click:Connect(function()
        for _, t in ipairs(tabDefs) do
            TweenService:Create(t.button, TweenInfo.new(0.2), { BackgroundTransparency = 0.4, TextColor3 = Theme.TextMuted }):Play()
            TweenService:Create(t.stroke, TweenInfo.new(0.2), { Thickness = 0, Transparency = 1 }):Play()
        end
        TweenService:Create(tab.button, TweenInfo.new(0.2), { BackgroundTransparency = 0, TextColor3 = Theme.Text }):Play()
        TweenService:Create(tab.stroke, TweenInfo.new(0.2), { Thickness = 2, Transparency = 0 }):Play()
        switchPage(tab.page)
    end)
end

task.spawn(function()
    task.wait(0.1)
    protectionTab.BackgroundTransparency = 0
    protectionTab.TextColor3             = Theme.Text
    protectionStroke.Thickness           = 2
    protectionStroke.Transparency        = 0
    switchPage("Protection")
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  MINIMISER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local minimized = false
minimizeBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        minimizeBtn.Text = "+"
        TweenService:Create(mainContainer, TweenInfo.new(0.3, Enum.EasingStyle.Quart), { Size = UDim2.new(0, 540, 0, 60) }):Play()
        tabContainer.Visible = false
        contentArea.Visible  = false
    else
        minimizeBtn.Text = "âˆ’"
        TweenService:Create(mainContainer, TweenInfo.new(0.3, Enum.EasingStyle.Quart), { Size = UDim2.new(0, 540, 0, 650) }):Play()
        tabContainer.Visible = true
        contentArea.Visible  = true
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  DRAG
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local dragging4 = false
local dragStart4, startPos4

header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging4  = true
        dragStart4 = input.Position
        startPos4  = mainContainer.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging4 = false end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging4 and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart4
        mainContainer.Position = UDim2.new(
            startPos4.X.Scale, startPos4.X.Offset + delta.X,
            startPos4.Y.Scale, startPos4.Y.Offset + delta.Y
        )
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  RACCOURCIS CLAVIER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.F then
        if not remoteReady then return end
        for _, player in ipairs(selectedPlayers) do
            if player and player.Parent == Players then
                pcall(function()
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", player, "kick")
                end)
                task.wait(0.05)
            end
        end
    elseif input.KeyCode == Enum.KeyCode.Insert then
        mainContainer.Visible = not mainContainer.Visible
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  PING & FPS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local pingTimer5 = 0
local fpsTimer5  = 0
local fpsCount5  = 0

RunService.RenderStepped:Connect(function(dt)
    fpsTimer5 += dt; fpsCount5 += 1
    if fpsTimer5 >= 1 then
        local fps = fpsCount5; fpsCount5 = 0; fpsTimer5 = 0
        wmFPS.Text       = "FPS: " .. tostring(fps)
        wmFPS.TextColor3 = fps >= 60 and Theme.Success or (fps >= 30 and Theme.Warning or Theme.Danger)
    end

    pingTimer5 += dt
    if pingTimer5 < 0.5 then return end
    pingTimer5 = 0

    local ok, ping = pcall(function()
        return math.floor(game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue())
    end)

    if ok then
        local col = ping < 50 and Theme.Success or (ping < 100 and Theme.Warning or Theme.Danger)
        pingLabel.Text       = tostring(ping) .. " ms"
        pingLabel.TextColor3 = col
        wmPing.Text          = "Ping: " .. tostring(ping) .. "ms"
        wmPing.TextColor3    = col
    else
        pingLabel.Text       = "-- ms"
        pingLabel.TextColor3 = Theme.TextMuted
        wmPing.Text          = "Ping: --ms"
        wmPing.TextColor3    = Theme.TextMuted
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  AUTO LOAD CONFIG  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
--  Tout en bas â€” UI 100% construite, toutes les fonctions dÃ©finies
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
task.spawn(function()
    task.wait(2.5)

    print("[SloDyZz HUB] ğŸ” Recherche config dans workspace executor...")

    local cfg = loadConfig()

    if cfg then
        print("[SloDyZz HUB] âœ… Config trouvÃ©e! SauvegardÃ©e le: " .. (cfg.SavedAt or "?"))

        -- 1) Appliquer les valeurs dans State
        applyConfig(cfg)

        -- 2) Synchroniser les visuels de l'UI (sans re-dÃ©clencher les callbacks)
        task.wait(0.1)
        syncUIWithState()

        -- 3) DÃ©marrer les systÃ¨mes actifs
        task.wait(0.2)
        applyLoadedEffects()

        -- 4) Rapport
        print("[SloDyZz HUB] ğŸ“Š ParamÃ¨tres restaurÃ©s:")
        print("  â€¢ Insta Grab   : " .. (State.InstaGrab     and ("ON (rayon: " .. State.GrabRadius .. ")") or "OFF"))
        print("  â€¢ Anti KB      : " .. (State.AntiKnockback  and "ON" or "OFF"))
        print("  â€¢ Speed Boost  : " .. (State.SpeedBoost     and ("ON (v=" .. State.SpeedValue .. " j=" .. State.JumpValue .. ")") or "OFF"))
        print("  â€¢ Anti Scam    : " .. (State.AntiScam       and "ON" or "OFF"))
        print("  â€¢ Anti Trap    : " .. (State.AntiTrap       and "ON" or "OFF"))
        print("  â€¢ Base ESP     : " .. (State.BaseESP        and "ON" or "OFF"))
        print("  â€¢ Skeleton ESP : " .. (State.SkeletonESP    and "ON" or "OFF"))
        print("  â€¢ Hitbox ESP   : " .. (State.HitboxESP      and "ON" or "OFF"))
        print("[SloDyZz HUB] ğŸ‰ Restauration complÃ¨te!")
    else
        print("[SloDyZz HUB] â„¹ï¸  Aucune config â†’ " .. CONFIG_FILE)
        print("[SloDyZz HUB] ğŸ’¾ Clique 'Sauvegarder la Configuration' pour crÃ©er ton profil.")
    end
end)

print("[SloDyZz HUB] âœ“ ChargÃ© avec succÃ¨s!")
print("[SloDyZz HUB] âš¡ Insta Grab Â· ğŸ›¡ Anti Trap Â· ğŸ’¨ Speed Â· ğŸ›¡ Anti KB Â· ğŸ‘ ESP")
print("[SloDyZz HUB] ğŸ® INSERT = afficher/masquer | F = kick sÃ©lectionnÃ©")
print("[SloDyZz HUB] ğŸ’¾ Config: SloDyZzHub/config.json (dans workspace executor)")
print("[SloDyZz HUB] ğŸ’¬ discord.gg/TmevzZSkhp | By SloDyZz & Ghosty")
